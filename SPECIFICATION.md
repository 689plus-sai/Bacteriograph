# プロジェクト仕様書: Bacteriograph

## 1. プロジェクト概要
**名称**: Bacteriograph
**目的**: 物理演算を用いて、カタカナをパーティクル（粒子）の集合体として再構築・デザインするジェネレーティブアートツール。ユーザーは独自のタイポグラフィを作成・操作し、SVG形式でエクスポート可能。
**デザイン哲学**: スイス・スタイル / 構成主義 (ミニマリズム、グリッドベース、サンセリフ体、ダークモード)。

## 2. 技術スタック
- **ライブラリ**: p5.js (v1.9.0+)
- **ビルドツール**: Vite
- **言語**: Vanilla JavaScript
- **スタイル**: Vanilla CSS (CSS変数、Flexbox/Grid使用)
- **フォント**: Google Fonts ("Inter"をUIに使用、Canvas内描画にも適用)

## 3. 主要機能

### 3.1. テキスト生成 (Text Generation)
- **入力**: カタカナ入力に対応（英数字も描画可能だが主眼はカタカナ）。
- **サンプリング**: テキストの形状に基づき、モンテカルロ法を用いてパーティクルを適切な密度で配置。
- **パーティクルシステム**:
  - **形状**: 円、四角形、三角形、五角形、六角形。
  - **描画モード**: 「塗り (Fill)」と「線 (Stroke)」を個々のパーティクルごとにランダム割り当て。

### 3.2. 物理シミュレーション (Physics Simulation)
- **挙動 (Behaviors)**:
  - **反発/引力**: 各パーティクルに「WANDER（徘徊）」「STAY（維持）」「ATTRACT（引力）」「REPEL（斥力）」の役割を付与し、相互作用させる。
  - **浮遊感**: 全体に正弦波（sin/cos）を用いた緩やかな浮遊アニメーションを適用。
  - **マウスインタラクション**: マウスカーソルに対する回避行動。キャンバス外にカーソルが出た場合は反応を停止する（誤作動防止）。
  - **重力**: パラメータで調整可能な重力を適用可能。

### 3.3. カスタマイズと操作 (Controls)
| パラメータ | 説明 |
| :--- | :--- |
| **サイズ (Size)** | パーティクルの基本サイズ。 |
| **表示倍率 (Zoom)** | カメラのズームレベル (0.1x ～ 2.0x)。 |
| **角丸 (Radius)** | 四角形パーティクルの角の丸み。 |
| **重力 (Gravity)** | 下方向への重力の強さ。 |
| **反応強度 (Reaction)** | マウスやパーティクル同士の反発力の強さ。 |
| **色相 (Hue)** | カラーテーマの設定。<br> - **0 (左端)**: **マルチカラーモード**（調和のとれたランダムカラー）。<br> - **>0**: **単色モード**（指定色をベースにした同系色のバリエーション）。 |

### 3.4. エクスポート・便利機能
- **SVG保存**:
  - 外部ライブラリに依存しない独自の堅牢なSVG生成機能。
  - 画面上の見た目（色、形状、塗り/線）を忠実に再現したベクターデータを出力。
  - ファイル保存ダイアログ（`showSaveFilePicker`）対応により、保存先を任意に指定可能。
- **フルスクリーン**: `F` キーでUI非表示/再表示。
- **グリッド**: `G` キーで背景のスイス・グリッド表示/非表示。
- **一時停止**: `Enter` キーで物理演算の一時停止/再開。

## 4. ファイル構成
```
/
├── index.html          # エントリーポイント、UI構造
├── package.json        # 依存関係定義
└── src/
    ├── main.js         # スクリプトエントリー、CSS読み込み
    ├── style.css       # グローバルスタイル、ダークテーマ設定
    ├── sketch.js       # p5.jsの主要ロジック（セットアップ、描画、インタラクション、保存）
    └── TextParticle.js # パーティクルクラス（物理演算、描画、個体差の管理）
```

## 5. 主要システムロジック

### 5.1. カラーシステム (Color System)
- **マルチカラー**: 各パーティクルが持つ固有の乱数シード（`hueOffset`）に基づき、鮮やかで調和のとれた色を生成。
- **ターゲットカラー**: 色相スライダー操作時は、選択された色相を基準に、個々のオフセットを加味して色の深み（同系色グラデーション）を表現。

### 5.2. ビューポート管理 (Viewport Management)
- **パン＆ズーム**: 描画コンテキスト全体に行列変換（Matrix Wrap）を適用し、スムーズな拡大縮小と移動を実現。
- **座標変換**: 画面上のマウス座標を「逆行列変換」してワールド座標に戻すことで、ズーム中も正確な当たり判定を維持。

### 5.3. パフォーマンス最適化
- **空間分割グリッド (Spatial Grid)**: 画面をグリッド状に分割し、近隣のパーティクル同士のみ計算を行うことで、計算量を $O(n^2)$ から $O(n)$ に削減。
- **テクスチャ制限**: 生成バッファサイズに上限（4096px）を設け、高負荷によるブラウザクラッシュを防止。
